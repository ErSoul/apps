
pkgname=amarok
pkgver=2.8.80
pkgrel=1
pkgdesc="A media player for KDE"
arch=('x86_64')
url="http://amarok.kde.org"
license=('GPL2' 'LGPL2' 'FDL')
depends=('kcoreaddons' 'solid' 'kdelibs4support' 'kcodecs' 'ki18n' 'threadweaver' 'plasma-framework'
         'kcmutils' 'knewstuff' 'ktexteditor' 'kglobalaccel' 'kio' 'knotifyconfig' 'karchive' 'kdnssd'
         'kconfigwidgets'
         'mariadb' 'taglib-extras' 'ffmpeg' 'libofa' 'mesa' 'loudmouth' 'clamz' 'gst-plugins-bad' 
         'ifuse' 'libgpod' 'libmtp'
         'qca-qt5' 'liblastfm' 'qjson' 'libmygpo-qt' 'qt5-webkit')
makedepends=('pkgconfig' 'extra-cmake-modules' 'kdoctools' 'git')
groups=('multimedia')
install="${pkgname}.install"
#source=("http://mirrors.mit.edu/kde/stable/${pkgname}/${pkgver}/src/${pkgname}-${pkgver}.tar.bz2")
#md5sums=('53cfcb4819668b10e13b061478c7b32a')
source=("git://anongit.kde.org/amarok.git#branch=kf5"
        'qt5.5.diff')
md5sums=('SKIP'
         'e9b525b8df90bdd2880bd095cd5f3826')

prepare() {
  cd $pkgname
  #patch -p1 -i $srcdir/qt5.5.diff
  #sed -i -e 's|find_library( LIBMYGPO_QT_LIBRARY NAMES mygpo-qt5|find_library( LIBMYGPO_QT_LIBRARY NAMES mygpo-qt|' ${srcdir}/${pkgname}/cmake/modules/FindLibmygpo-qt.cmake
  sed -i -e 's|LIBLASTFM_LIBRARY NAMES lastfm5|LIBLASTFM_LIBRARY NAMES lastfm|' ${srcdir}/${pkgname}/cmake/modules/FindLibLastFm.cmake
  sed -i -e 's|KIO NotifyConfig Archive)|KIO NotifyConfig Archive ConfigWidgets)|' ${srcdir}/${pkgname}/CMakeLists.txt
}

build() {
  mkdir -p build
  cd build
  
  cmake ../${pkgname} \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DLIB_INSTALL_DIR=lib \
    -DPLUGIN_INSTALL_DIR=/usr/lib/qt5/plugins \
    -DKDE_INSTALL_USE_QT_SYS_PATHS=ON \
    -DBUILD_TESTING=OFF 
  make
}

package() {
  cd build

  make DESTDIR=${pkgdir} install
}
