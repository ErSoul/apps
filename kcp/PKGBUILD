
pkgname=kcp
pkgver=0.28
pkgrel=1
_commit=d2e8e36
pkgdesc="A command-line tool for KaOS Community Packages"
arch=('x86_64')
url="https://github.com/bvaudour/kcp"
license=('Public Domain')
install=kcp.install
depends=('git')
makedepends=('go')
source=("https://github.com/bvaudour/kcp/tarball/master/kcp-${pkgver}.tar.gz")
#source=("https://github.com/bvaudour/kcp/releases/download/${pkgver}/kcp-${pkgver}.tar.gz")
md5sums=('f7913c9dee7126b0871d4b1f434f156f')
 
build() {
  cd ${srcdir}/bvaudour-${pkgname}-${_commit}
  
  export GOPATH=${GOPATH}:"${srcdir}"
  ./configure 
  make 
}

package() {
  cd ${srcdir}/bvaudour-${pkgname}-${_commit} 
  make DESTDIR="${pkgdir}" install
  
  for files in i18n/*; do
  if [ -f "$files" ] && [ "$files" != 'i18n/kcp.pot' ]; then
        STRING_PO=`echo ${files#*/}`
        STRING=`echo ${STRING_PO%.po}`
        mkdir -p ${pkgdir}/usr/share/locale/${STRING}/LC_MESSAGES
        msgfmt $files -o ${pkgdir}/usr/share/locale/${STRING}/LC_MESSAGES/kcp.mo
        echo "${STRING} installed..."
  fi
  done

  install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}