
pkgname=installer-partitionmanager
_pkgname=partitionmanager
pkgver=1274507
pkgrel=4
arch=('x86_64')
pkgdesc="Easily manage disks, partitions and file systems on your KDE Desktop"
url="https://sourceforge.net/projects/partitionman"
license=('GPL2')
depends=('kdebase-runtime' 'parted' 'libatasmart')
makedepends=('cmake' 'automoc4' 'pkg-config' 'svn' 'ntfs-3g')
optdepends=('e2fsprogs: ext2/3/4 support'
	    'xfsprogs: XFS support'
	    'jfsutils: JFS support'
	    'reiserfsprogs: Reiser support'
	    'ntfs-3g: NTFS support'
	    'dosfstools: FAT32 support')
conflict=('partitionmanager')
install=partitionmanager.install
options=('debug')
source=("http://sourceforge.net/projects/kaosx/files/sources/$_pkgname/$pkgver/$_pkgname.tar.xz"
        'installer.patch'
        'kpart_btrfs.diff')
md5sums=('e4a1549afb6888d35fbce091eee6f7d0'
         '89a42ad1a564a3809ccbb90d8e2c9b19'
         '49642970bdc2d4c6894c40c830c2d369')

build() {
  cd "${srcdir}"
  # filsystem code from src/fs/filesystem.h, set as default
  sed -i -e 's/FileSystem::Ext3/FileSystem::Xfs/' ${srcdir}/$_pkgname/src/config.kcfg
  patch -p0 -i ${srcdir}/installer.patch
  patch -p0 -i ${srcdir}/kpart_btrfs.diff
  
  mkdir build
  cd build

  cmake ../$_pkgname \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo 

  make 
}

package() {
  cd build
  
  make DESTDIR="${pkgdir}" install
}
