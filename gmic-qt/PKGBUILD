
pkgname=gmic-qt
pkgver=2.2.1
_gmic=e77c9de03d2c9f89d352e2c099e9a13fa0db6d01
_commit=bf3ab8fecec9834b382c6745d3e13471ff4d1a21
pkgrel=1
pkgdesc="Plug-in to bring the full-featured open-source framework for image processing -G'MIC- to Krita"
url="http://gmic.eu/"
license=('GPLv3')
arch=('x86_64')
depends=('qt5-base' 'libpng' 'zlib' 'fftw' 'curl')
makedepends=('cmake' 'qt5-tools')
source=("https://github.com/dtschump/gmic/archive/${_gmic}.zip"
        "https://github.com/c-koi/gmic-qt/archive/${_commit}.zip")
md5sums=('84900f264608367ade20bba17956e6ea'
         'ca8a5b21eb561180ad9327e3cac6c65b')

build() {
  cd gmic-${_gmic}/
  make -C src CImg.h gmic_stdlib.h
  
  cd ../gmic-qt-${_commit}
  cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DGMIC_QT_HOST=krita \
    -DGMIC_PATH="../gmic-${_gmic}/src" 
  make
}

package() {
  cd gmic-qt-${_commit}
  
  #make DESTDIR=${pkgdir} install
  install -D -m755 gmic_krita_qt ${pkgdir}/usr/bin/gmic_krita_qt
  #install -D -m755 *.qm ${pkgdir}/usr/share/gmic-qt/locale/
  
  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
} 
