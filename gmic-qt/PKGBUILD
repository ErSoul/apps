
pkgname=gmic-qt
pkgver=2.3.4
_gmic=87bba521df19663031c893bb15ffc49696fc2d12
_commit=e1f2980bba8cdb4d626c9f15eaa909ba304afe10
pkgrel=1
pkgdesc="Plug-in to bring the full-featured open-source framework for image processing -G'MIC- to Krita"
url="http://gmic.eu/"
license=('GPLv3')
arch=('x86_64')
depends=('qt5-base' 'libpng' 'zlib' 'fftw' 'curl')
makedepends=('cmake' 'qt5-tools')
source=("https://github.com/dtschump/gmic/archive/${_gmic}.zip"
        "https://github.com/c-koi/gmic-qt/archive/${_commit}.zip")
md5sums=('29bd5338b06fe7b4ecdefab6725e6439'
         '9ea2f5f2f3c097571a646853987ff4c8')
build() {
  cd gmic-${_gmic}/
  make -C src CImg.h gmic_stdlib.h
  
  cd ../gmic-qt-${_commit}
  cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DGMIC_QT_HOST=krita \
    -DGMIC_PATH="../gmic-${_gmic}/src" 
  make
}

package() {
  cd gmic-qt-${_commit}
  
  #make DESTDIR=${pkgdir} install
  install -D -m755 gmic_krita_qt ${pkgdir}/usr/bin/gmic_krita_qt
  #install -D -m755 *.qm ${pkgdir}/usr/share/gmic-qt/locale/
  
  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
} 
