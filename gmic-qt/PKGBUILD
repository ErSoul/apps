
pkgname=gmic-qt
pkgver=2.3.2
_gmic=a3ae92d32c0ae8082fbef1fd070e315bdf9e7c1d
_commit=f6e904d919633f0177fd0faa898ffcb636b51d4f
pkgrel=1
pkgdesc="Plug-in to bring the full-featured open-source framework for image processing -G'MIC- to Krita"
url="http://gmic.eu/"
license=('GPLv3')
arch=('x86_64')
depends=('qt5-base' 'libpng' 'zlib' 'fftw' 'curl')
makedepends=('cmake' 'qt5-tools')
source=("https://github.com/dtschump/gmic/archive/${_gmic}.zip"
        "https://github.com/c-koi/gmic-qt/archive/${_commit}.zip")
md5sums=('62e2aa7002b16bdbaa2edb94aed26a20'
         '7e3956df90c3c79e4e386082b720c041')
build() {
  cd gmic-${_gmic}/
  make -C src CImg.h gmic_stdlib.h
  
  cd ../gmic-qt-${_commit}
  cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DGMIC_QT_HOST=krita \
    -DGMIC_PATH="../gmic-${_gmic}/src" 
  make
}

package() {
  cd gmic-qt-${_commit}
  
  #make DESTDIR=${pkgdir} install
  install -D -m755 gmic_krita_qt ${pkgdir}/usr/bin/gmic_krita_qt
  #install -D -m755 *.qm ${pkgdir}/usr/share/gmic-qt/locale/
  
  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
} 
