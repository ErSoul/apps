
pkgname=qupzilla
pkgver=1.8.6
_commit=cc08957
pkgrel=1
pkgdesc="A fast open source browser based on WebKit core, written in Qt Framework"
arch=('x86_64')
url="http://www.qupzilla.com/"
license=('GPL')
depends=('qt5-webkit' 'qt5-script' 'mesa' 'kwallet' 'hunspell' 'desktop-file-utils')
#depends=('qtwebkit' 'qtwebkit-plugins' 'mesa' 'kdelibs')
makedepends=('gdb' 'qt5-tools')
groups=('network')
source=("https://github.com/QupZilla/QupZilla/tarball/master/QupZilla-qupzilla-${pkgver}.tar.gz"
#source=("https://github.com/QupZilla/qupzilla/releases/download/v${pkgver}/QupZilla-${pkgver}.tar.xz"
        'speeddial.diff'
        'preferences.diff'
        'browserwindow.diff'
        'defines.diff'
        'bookmarks_json.diff')
md5sums=('72472c0b210e2d436d9a7ce50e40575e'
         '65cd96b4e2d5b12df25e088f8409acd6'
         'c747d63df3218d038546fd93ba531178'
         'ea860e4bd5a7ca23445482e1fde186b5'
         'f5207fdb5455567352fbabb63f36f731'
         'ad89b6d6e006941325aa77856c29f3e3')

build() {
    cd "${srcdir}/QupZilla-qupzilla-${_commit}/"
    #cd "${srcdir}/QupZilla-${pkgver}"
    patch -p0 -i "${srcdir}/speeddial.diff"
    patch -p0 -i "${srcdir}/preferences.diff"
    patch -p0 -i "${srcdir}/browserwindow.diff"
    patch -p0 -i "${srcdir}/defines.diff"
    patch -p0 -i "${srcdir}/bookmarks_json.diff"
    
    sed -e "s|<KDE/KWallet/Wallet>|<KF5/KWallet/KWallet>|" -i ${srcdir}/QupZilla-qupzilla-${_commit}/src/plugins/KWalletPasswords/kwalletpasswordbackend.h

    export USE_WEBGL="true"
    #export NO_X11="true"
    export KDE_INTEGRATION="true"
   
    /usr/lib/qt5/bin/qmake 
    #qmake
    make clean
    make
}

package() {
    cd "${srcdir}/QupZilla-qupzilla-${_commit}/"
    #cd "${srcdir}/QupZilla-${pkgver}"
    make INSTALL_ROOT="$pkgdir/" install
    
    cp "$pkgdir/usr/share/qupzilla/locale/de_DE.qm" "$pkgdir/usr/share/qupzilla/locale/de_CH.qm"
    cp "$pkgdir/usr/share/qupzilla/locale/de_DE.qm" "$pkgdir/usr/share/qupzilla/locale/de_AT.qm"
    #cp "$pkgdir/usr/share/qupzilla/locale/es_ES.qm" "$pkgdir/usr/share/qupzilla/locale/es_AR.qm"
}
