
pkgname=calamares
pkgver=0.1.0.6
pkgrel=1
pkgdesc='Distribution-independent installer framework'
arch=('x86_64')
url='https://github.com/calamares/calamares'
license=('LGPL')
depends=('qt5-base' 'kconfig' 'kconfigwidgets' 'ki18n' 'kcoreaddons' 'solid' 'yaml-cpp'
         'parted' 'libatasmart' 'udisks2')
makedepends=('extra-cmake-modules' 'git' 'qt5-tools')
source=("git://github.com/calamares/calamares"
        'settings.conf'
        'module.conf'
        'CMakeLists_new.diff')
md5sums=('SKIP'
         'c50734eddf2c410eab66c0a1e1ca660e'
         '78f312a1edf38c0932d78904ae9fb8c4'
         'b009eb45e26b5c753430630c5e756adc')

prepare () {
  cd ${srcdir}/${pkgname}
  
  git submodule init
  git submodule update
  patch -p0 -i ${srcdir}/CMakeLists_new.diff
  #sed -i 's|KF5 CONFIG REQUIRED|KF5 REQUIRED|' ${srcdir}/${pkgname}/src/libcalamares/partitionmanager/CMakeLists.txt
}

build() {
  mkdir -p build
  
  cd build
  
  cmake ../${pkgname} \
    -DCMAKE_BUILD_TYPE=Debug \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DWITH_PARTITIONMANAGER=1 \
    -DCMAKE_INSTALL_LIBDIR=lib 
  make
}

package() {
  cd build 
  make DESTDIR="${pkgdir}" install
  
  #rm -rf "${pkgdir}/usr/share/calamares/settings.conf"
  #install -D -m644 "${srcdir}/settings.conf" "${pkgdir}/usr/share/calamares/settings.conf"
  #rm -rf "${pkgdir}/usr/lib/calamares/modules/locale/module.conf"
  #install -D -m644 "${srcdir}/module.conf" "${pkgdir}/usr/lib/calamares/modules/locale/module.conf"
  #sed 's|/path/to/squashfs/image.sqfs|/bootmnt/kdeos/x86_64/root-image.sqfs|' -i "${pkgdir}/usr/lib/calamares/modules/unsquashfs/module.conf"
  #sed 's|linux312|linux|' -i "${pkgdir}/usr/lib/calamares/modules/initcpio/module.conf"
}
